/**
* SoundJS
* Visit http://createjs.com/ for documentation, updates and examples.
*
* Copyright (c) 2011 gskinner.com, inc.
* 
* Distributed under the terms of the MIT license.
* http://www.opensource.org/licenses/mit-license.html
*
* This notice shall be included in all copies or substantial portions of the Software.
**/

this.createjs=this.createjs||{},function(){function e(){throw"SoundJS cannot be instantiated"}function t(e,t){this.init(e,t)}function n(){}e.DELIMITER="|",e.AUDIO_TIMEOUT=8e3,e.INTERRUPT_ANY="any",e.INTERRUPT_EARLY="early",e.INTERRUPT_LATE="late",e.INTERRUPT_NONE="none",e.PLAY_INITED="playInited",e.PLAY_SUCCEEDED="playSucceeded",e.PLAY_INTERRUPTED="playInterrupted",e.PLAY_FINISHED="playFinished",e.PLAY_FAILED="playFailed",e.activePlugin=null,e.muted=!1,e.pluginsRegistered=!1,e.masterVolume=1,e.instances=[],e.instanceHash={},e.idHash=null,e.defaultSoundInstance=null,e.getPreloadHandlers=function(){return{callback:e.proxy(e.initLoad,e),types:["sound"],extensions:["mp3","ogg","wav"]}},e.registerPlugins=function(t){e.pluginsRegistered=!0;for(var n=0,r=t.length;n<r;n++){var i=t[n];if(i!=null&&i.isSupported())return e.activePlugin=new i,!0}return!1},e.registerPlugin=function(t){return e.pluginsRegistered=!0,t==null?!1:t.isSupported()?(e.activePlugin=new t,!0):!1},e.isReady=function(){return e.activePlugin!=null},e.getCapabilities=function(){return e.activePlugin==null?null:e.activePlugin.capabilities},e.getCapability=function(t){return e.activePlugin==null?null:e.activePlugin.capabilities[t]},e.initLoad=function(n,r,i,s){return e.checkPlugin(!0)?(n=e.parsePath(n,r,i,s),n==null?!1:(i!=null&&(e.idHash==null&&(e.idHash={}),e.idHash[i]=n.src),t.create(n.src,s),i=e.activePlugin.register(n.src,s),i!=null&&(i.tag!=null?n.tag=i.tag:i.src&&(n.src=i.src),i.completeHandler!=null&&(n.handler=i.completeHandler)),n)):!1},e.parsePath=function(t,n,r,i){for(var t=t.split(e.DELIMITER),n={type:n||"sound",id:r,data:i,handler:e.handleSoundReady},r=!1,i=e.getCapabilities(),s=0,o=t.length;s<o;s++){var u=t[s],a=u.lastIndexOf("."),f=u.substr(a+1).toLowerCase(),a=u.substr(0,a).split("/").pop();switch(f){case"mp3":i.mp3&&(r=!0);break;case"ogg":i.ogg&&(r=!0);break;case"wav":i.wav&&(r=!0)}if(r)return n.name=a,n.src=u,n.extension=f,n}return null},e.play=function(t,n,r,i,s,o,u){if(!e.checkPlugin(!0))return e.defaultSoundInstance;t=e.getSrcFromId(t),t=e.activePlugin.create(t);try{t.mute(e.muted)}catch(a){}return e.playInstance(t,n,r,i,s,o,u)||t.playFailed(),t},e.playInstance=function(t,n,r,i,s,o,u){n=n||e.INTERRUPT_NONE,r==null&&(r=0),i==null&&(i=0),s==null&&(s=0),o==null&&(o=1),u==null&&(u=0);if(r==0){if(!e.beginPlaying(t,n,i,s,o,u))return!1}else setTimeout(function(){e.beginPlaying(t,n,i,s,o,u)},r);return this.instances.push(t),this.instanceHash[t.uniqueId]=t,!0},e.beginPlaying=function(e,n,r,i,s,o){return t.add(e,n)?e.beginPlaying(r,i,s,o)?!0:(this.instances.splice(this.instances.indexOf(e),1),delete this.instanceHash[e.uniqueId],!1):!1},e.checkPlugin=function(t){return e.activePlugin==null&&(t&&!e.pluginsRegistered&&e.registerPlugin(createjs.HTMLAudioPlugin),e.activePlugin==null)?!1:!0},e.getSrcFromId=function(t){return e.idHash==null||e.idHash[t]==null?t:e.idHash[t]},e.setVolume=function(t,n){return Number(t)==null?!1:(t=Math.max(0,Math.min(1,t)),e.tellAllInstances("setVolume",n,t))},e.getMasterVolume=function(){return e.masterVolume},e.setMasterVolume=function(t){return e.masterVolume=t,e.tellAllInstances("setMasterVolume",null,t)},e.setMute=function(t){return this.muted=t,e.tellAllInstances("mute",null,t)},e.pause=function(t){return e.tellAllInstances("pause",t)},e.resume=function(t){return e.tellAllInstances("resume",t)},e.stop=function(t){return e.tellAllInstances("stop",t)},e.getInstanceById=function(e){return this.instanceHash[e]},e.playFinished=function(e){t.remove(e),this.instances.splice(this.instances.indexOf(e),1)},e.tellAllInstances=function(e,t,n){if(this.activePlugin==null)return!1;for(var t=this.getSrcFromId(t),r=this.instances.length-1;r>=0;r--){var i=this.instances[r];if(t==null||i.src==t)switch(e){case"pause":i.pause();break;case"resume":i.resume();break;case"setVolume":i.setVolume(n);break;case"setMasterVolume":i.setMasterVolume(n);break;case"mute":i.mute(n);break;case"stop":i.stop();break;case"setPan":i.setPan(n)}}return!0},e.proxy=function(e,t){return function(){return e.apply(t,arguments)}},createjs.SoundJS=e,t.channels={},t.create=function(e,n){var r=t.get(e);r==null?t.channels[e]=new t(e,n):r.max+=n},t.add=function(e,n){var r=t.get(e.src);return r==null?!1:r.add(e,n)},t.remove=function(e){var n=t.get(e.src);return n==null?!1:(n.remove(e),!0)},t.get=function(e){return t.channels[e]},t.prototype={src:null,max:null,length:0,init:function(e,t){this.src=e,this.max=t||1,this.instances=[]},get:function(e){return this.instances[e]},add:function(e,t){return this.getSlot(t,e)?(this.instances.push(e),this.length++,!0):!1},remove:function(e){return e=this.instances.indexOf(e),e==-1?!1:(this.instances.splice(e,1),this.length--,!0)},getSlot:function(t){for(var n,r,i=0,s=this.max||100;i<s;i++){n=this.get(i);if(n==null)return!0;if(t==e.INTERRUPT_NONE)continue;if(i==0)r=n;else if(n.playState==e.PLAY_FINISHED||n==e.PLAY_INTERRUPTED||n==e.PLAY_FAILED)r=n;else if(t==e.INTERRUPT_EARLY&&n.getPosition()<r.getPosition()||t==e.INTERRUPT_LATE&&n.getPosition()>r.getPosition())r=n}return r!=null?(r.interrupt(),this.remove(r),!0):!1},toString:function(){return"[SoundJS SoundChannel]"}},e.defaultSoundInstance=new function(){this.isDefault=!0,this.pause=this.resume=this.play=this.beginPlaying=this.cleanUp=this.interrupt=this.stop=this.setMasterVolume=this.setVolume=this.mute=this.setPan=this.getPosition=this.setPosition=this.playFailed=function(){return!1},this.getVolume=this.getPan=this.getDuration=function(){return 0},this.playState=e.PLAY_FAILED,this.toString=function(){return"[SoundJS Default Sound Instance]"}},n.init=function(){var e=navigator.userAgent;n.isFirefox=e.indexOf("Firefox")>-1,n.isOpera=window.opera!=null,n.isIOS=e.indexOf("iPod")>-1||e.indexOf("iPhone")>-1||e.indexOf("iPad")>-1},n.init(),createjs.SoundJS.BrowserDetect=n}(),this.createjs=this.createjs||{},function(){function e(){this.init()}function t(e){this.init(e)}function n(e){this.init(e)}e.MAX_INSTANCES=30,e.capabilities=null,e.lastId=0,e.AUDIO_READY="canplaythrough",e.AUDIO_ENDED="ended",e.AUDIO_ERROR="error",e.AUDIO_STALLED="stalled",e.fillChannels=!1,e.isSupported=function(){return createjs.SoundJS.BrowserDetect.isIOS?!1:(e.generateCapabilities(),e.tag==null?!1:!0)},e.generateCapabilities=function(){if(e.capabilities==null){var t=e.tag=document.createElement("audio");if(t.canPlayType==null)return null;e.capabilities={panning:!1,volume:!0,mp3:t.canPlayType("audio/mp3")!="no"&&t.canPlayType("audio/mp3")!="",ogg:t.canPlayType("audio/ogg")!="no"&&t.canPlayType("audio/ogg")!="",mpeg:t.canPlayType("audio/mpeg")!="no"&&t.canPlayType("audio/mpeg")!="",wav:t.canPlayType("audio/wav")!="no"&&t.canPlayType("audio/wav")!="",channels:e.MAX_INSTANCES}}},e.prototype={capabilities:null,FT:.001,channels:null,init:function(){this.capabilities=e.capabilities,this.channels={}},register:function(e,t){for(var r=n.get(e),i,s=0,o=t||1;s<o;s++)i=this.createTag(e),r.add(i);return{tag:i}},createTag:function(e){var t=document.createElement("audio");return t.preload=!1,t.src=e,t},create:function(e){return e=new t(e),e.owner=this,e},toString:function(){return"[HTMLAudioPlugin]"}},createjs.HTMLAudioPlugin=e,t.prototype={src:null,uniqueId:-1,playState:null,owner:null,loaded:!1,lastInterrupt:createjs.SoundJS.INTERRUPT_NONE,offset:0,delay:0,volume:1,pan:0,remainingLoops:0,delayTimeout:-1,tag:null,muted:!1,paused:!1,onComplete:null,onLoop:null,onReady:null,onPlayFailed:null,onPlayInterrupted:null,endedHandler:null,readyHandler:null,stalledHandler:null,init:function(e){this.uniqueId=createjs.HTMLAudioPlugin.lastId++,this.src=e,this.endedHandler=createjs.SoundJS.proxy(this.handleSoundComplete,this),this.readyHandler=createjs.SoundJS.proxy(this.handleSoundReady,this),this.stalledHandler=createjs.SoundJS.proxy(this.handleSoundStalled,this)},cleanUp:function(){var e=this.tag;if(e!=null){e.pause();try{e.currentTime=0}catch(t){}e.removeEventListener(createjs.HTMLAudioPlugin.AUDIO_ENDED,this.endedHandler,!1),e.removeEventListener(createjs.HTMLAudioPlugin.AUDIO_READY,this.readyHandler,!1),n.setInstance(this.src,e),this.tag=null}window.createjs!=null&&createjs.SoundJS.playFinished(this)},interrupt:function(){this.tag!=null&&(this.playState=createjs.SoundJS.PLAY_INTERRUPTED,this.onPlayInterrupted&&this.onPlayInterrupted(this),this.cleanUp(),this.paused=!1)},play:function(e,t,n,r,i,s){this.cleanUp(),createjs.SoundJS.playInstance(this,e,t,n,r,i,s)},beginPlaying:function(e,t,r){if(window.createjs!=null){var i=this.tag=n.getInstance(this.src);return i==null?(this.playFailed(),-1):(i.addEventListener(createjs.HTMLAudioPlugin.AUDIO_ENDED,this.endedHandler,!1),this.offset=e,this.volume=r,this.updateVolume(),this.remainingLoops=t,i.readyState!==4?(i.addEventListener(createjs.HTMLAudioPlugin.AUDIO_READY,this.readyHandler,!1),i.addEventListener(createjs.HTMLAudioPlugin.AUDIO_STALLED,this.stalledHandler,!1),i.load()):this.handleSoundReady(null),1)}},handleSoundStalled:function(){this.onPlayFailed!=null&&this.onPlayFailed(this),this.cleanUp()},handleSoundReady:function(){window.createjs!=null&&((this.playState=createjs.SoundJS.PLAY_SUCCEEDED,this.paused=!1,this.tag.removeEventListener(createjs.HTMLAudioPlugin.AUDIO_READY,this.readyHandler,!1),this.offset>=this.getDuration())?this.playFailed():(this.offset>0&&(this.tag.currentTime=this.offset*.001),this.remainingLoops==-1&&(this.tag.loop=!0),this.tag.play()))},pause:function(){return this.paused=!0,this.tag!=null?(this.tag.pause(),!1):!0},resume:function(){return this.paused=!1,this.tag!=null?(this.tag.play(),!1):!0},stop:function(){return this.pause(),this.playState=createjs.SoundJS.PLAY_FINISHED,this.cleanUp(),!0},setMasterVolume:function(){return this.updateVolume(),!0},setVolume:function(e){return this.volume=e,this.updateVolume(),!0},updateVolume:function(){return this.tag!=null?(this.tag.volume=this.muted?0:this.volume*createjs.SoundJS.masterVolume,!0):!1},getVolume:function(){return this.volume},mute:function(e){return this.muted=e,this.updateVolume(),!0},setPan:function(){return!1},getPan:function(){return 0},getPosition:function(){return this.tag==null?0:this.tag.currentTime*1e3},setPosition:function(e){if(this.tag==null)return!1;try{this.tag.currentTime=e*.001}catch(t){return!1}return!0},getDuration:function(){return this.tag==null?0:this.tag.duration*1e3},handleSoundComplete:function(){this.remainingLoops!=0?(this.remainingLoops--,this.tag.play(),this.onLoop!=null)&&this.onLoop(this):window.createjs!=null&&(this.playState=createjs.SoundJS.PLAY_FINISHED,this.onComplete!=null&&this.onComplete(this),this.cleanUp())},playFailed:function(){window.createjs!=null&&(this.playState=createjs.SoundJS.PLAY_FAILED,this.onPlayFailed!=null&&this.onPlayFailed(this),this.cleanUp())},toString:function(){return"[HTMLAudioPlugin SoundInstance]"}},n.channels={},n.get=function(e){var t=n.channels[e];return t==null&&(t=n.channels[e]=new n(e)),t},n.getInstance=function(e){return e=n.channels[e],e==null?null:e.get()},n.setInstance=function(e,t){var r=n.channels[e];return r==null?null:r.set(t)},n.prototype={src:null,length:0,available:0,tags:null,init:function(e){this.src=e,this.tags=[]},add:function(e){this.tags.push(e),this.length++,this.available=this.tags.length},get:function(){if(this.tags.length==0)return null;this.available=this.tags.length;var e=this.tags.pop();return document.body.appendChild(e),e},set:function(e){this.tags.indexOf(e)==-1&&this.tags.push(e),document.body.removeChild(e),this.available=this.tags.length},toString:function(){return"[HTMLAudioPlugin TagChannel]"}}}();