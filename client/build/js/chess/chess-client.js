(function(e){e.exports={getPossibleMoves:function(e,t){var n={row:t.row,col:t.col},r=this.endGameCheck(e,t.type,n,n,t.color),i=r.allPossibleMoves,s=[];for(var o in i){var u=i[o];if(u.from.row==n.row&&u.from.col==n.col){var a=[];for(var f=0;f<e.length;f++){a[f]=[];for(var l=0;l<e[f].length;l++)a[f][l]=e[f][l]}a[u.from.row][u.from.col]="0",a[u.to.row][u.to.col]=u.color+""+u.type;var c=this._getAllPossibleMoves(a,u.color=="W"?"B":"W",!1),h=this.getChecker(a,c,u.color);h||s.push(u)}}return s},isValidMove:function(e,t,n,r,i){var s=this.endGameCheck(e,t,n,r,i),o=s.allPossibleMoves;for(var u in o){var a=o[u];if(this._moveEqual(a,{type:t,from:n,to:r,color:i})){var f=[];for(var l=0;l<e.length;l++){f[l]=[];for(var c=0;c<e[l].length;c++)f[l][c]=e[l][c]}f[n.row][n.col]="0",f[r.row][r.col]=i+""+t;var h=this._getAllPossibleMoves(f,i=="W"?"B":"W",!1),p=this.getChecker(f,h,i);return p?!1:!0}}return!1},endGameCheck:function(e,t,n,r,i){var s=i,o=this._getAllPossibleMoves(e,i=="W"?"B":"W",!1),u=this.getChecker(e,o,s),a=this._getAllPossibleMoves(e,i,!0,o,u),f=!1,l=!1;return u?(f=u.length>0&&a.length==0,l=u.length==0&&a.length==0):l=a.length==0,{allPossibleMoves:a,checkMate:f,staleMate:l,checkers:u}},canMoveHere:function(e,t,n,r,i){return i?e[t][n].charAt(0)!=r.color:!0},isOccupied:function(e,t,n){return e[t][n]!="0"},isEnemyOwned:function(e,t,n,r){return e[t][n].charAt(0)!=r.color&&e[t][n].charAt(0)!="0"},isEnemyControlled:function(e,t,n){if(!n)return!1;for(var r in n){var i=n[r];if(i.to.row==e&&i.to.col==t)return!0}return!1},getChecker:function(e,t,n){var r=[];for(var i in t){var s=t[i];e[s.to.row][s.to.col]==n+"K"&&r.push(s)}return r.length==0?null:r},_moveEqual:function(e,t){return e.from.row==t.from.row&&e.from.col==t.from.col&&e.to.row==t.to.row&&e.to.col==t.to.col&&e.type==t.type&&e.color==t.color},_willCaptureChecker:function(e,t){return e.from.row==t.row&&e.from.col==t.col?!0:!1},_willBlockChecker:function(e,t){if(e.type=="Q"||e.type=="R"||e.type=="B"){var n=t.col,r=t.row,i=e.from.col,s=e.from.row,o=e.to.col,u=e.to.row,a=(n-i)*(u-s),f=(r-s)*(o-i),l=function(e,t){return Math.sqrt((e.col-t.col)*(e.col-t.col)+(e.row-t.row)*(e.row-t.row))};return l(e.from,t)+l(t,e.to)==l(e.from,e.to)}return!1},_kingsMoveChecked:function(e,t,n){var r=[];for(var i=0;i<e.length;i++){r[i]=[];for(var s=0;s<e[i].length;s++)r[i][s]=e[i][s]}r[t.from.row][t.from.col]="0",r[t.to.row][t.to.col]=n+"K";var o=this._getAllPossibleMoves(r,n=="W"?"B":"W",!1),u=this.getChecker(r,o,n);return u?!0:!1},_getAllPossibleMoves:function(e,t,n,r,i){var s=[];for(var o=0;o<e.length;o++)for(var u=0;u<e[o].length;u++)if(e[o][u].charAt(0)==t){var a=null;if(i)if(i.length>1){if(e[o][u].charAt(1)!="K")continue}else a=i[0];var f=this._getPossibleMoves(e,{type:e[o][u].charAt(1),row:o,col:u,color:t},n,r,a);s.push.apply(s,f)}return s},_nextTile:function(e,t,n){var r={row:t.row+n.row,col:t.col+n.col};if(r.row>=0&&r.row<8&&r.col>=0&&r.col<8){var i=e[r.row][r.col];return{data:i,row:r.row,col:r.col}}return null},_castRay:function(e,t,n,r,i,s,o){var u=this._nextTile(e,n,t),a=[],f=!1;while(u){if(o)e[u.row][u.col]!=n.color+"K"&&(this._willBlockChecker(o,u)||this._willCaptureChecker(o,u))&&a.push(s({row:u.row,col:u.col}));else{if(u.data!="0"){f=!0;var l=e[u.row][u.col].charAt(0);(l!=n.color||!r)&&a.push(s({row:u.row,col:u.col}));break}a.push(s({row:u.row,col:u.col}))}u=this._nextTile(e,u,t)}return a},_getPossibleMoves:function(e,t,n,r,i){var s=[],o=function(e){return{type:t.type,from:{row:t.row,col:t.col},to:{row:e.row,col:e.col},color:t.color}};switch(t.type){case"K":var u={col:t.col,row:t.row};for(var a=u.row-1;a<=u.row+1;a++)if(a>=0&&a<8)for(var f=u.col-1;f<=u.col+1;f++)f>=0&&f<8&&this.canMoveHere(e,a,f,t,n)&&(n?!this.isEnemyControlled(a,f,r)&&(f!=u.col||a!=u.row)&&(this._kingsMoveChecked(e,{from:{row:t.row,col:t.col},to:{row:a,col:f}},t.color)||s.push(o({row:a,col:f}))):(f!=u.col||a!=u.row)&&s.push(o({row:a,col:f})));break;case"Q":var l=this._castRay(e,{row:-1,col:1},t,n,r,o,i);s.push.apply(s,l);var c=this._castRay(e,{row:-1,col:-1},t,n,r,o,i);s.push.apply(s,c);var h=this._castRay(e,{row:1,col:1},t,n,r,o,i);s.push.apply(s,h);var p=this._castRay(e,{row:1,col:-1},t,n,r,o,i);s.push.apply(s,p);var d=this._castRay(e,{row:0,col:1},t,n,r,o,i);s.push.apply(s,d);var v=this._castRay(e,{row:0,col:-1},t,n,r,o,i);s.push.apply(s,v);var m=this._castRay(e,{row:-1,col:0},t,n,r,o,i);s.push.apply(s,m);var g=this._castRay(e,{row:1,col:0},t,n,r,o,i);s.push.apply(s,g);break;case"B":var l=this._castRay(e,{row:-1,col:1},t,n,r,o,i);s.push.apply(s,l);var c=this._castRay(e,{row:-1,col:-1},t,n,r,o,i);s.push.apply(s,c);var h=this._castRay(e,{row:1,col:1},t,n,r,o,i);s.push.apply(s,h);var p=this._castRay(e,{row:1,col:-1},t,n,r,o,i);s.push.apply(s,p);break;case"R":var d=this._castRay(e,{row:0,col:1},t,n,r,o,i);s.push.apply(s,d);var v=this._castRay(e,{row:0,col:-1},t,n,r,o,i);s.push.apply(s,v);var m=this._castRay(e,{row:-1,col:0},t,n,r,o,i);s.push.apply(s,m);var g=this._castRay(e,{row:1,col:0},t,n,r,o,i);s.push.apply(s,g);break;case"N":var u={col:t.col,row:t.row};if(u.row-2>=0){if(u.col-1>=0&&this.canMoveHere(e,u.row-2,u.col-1,t,n))if(i){var y={row:t.row-2,col:t.col-1};(this._willBlockChecker(i,y)||this._willCaptureChecker(i,y))&&s.push(o({row:u.row-2,col:u.col-1}))}else s.push(o({row:u.row-2,col:u.col-1}));if(u.col+1<8&&this.canMoveHere(e,u.row-2,u.col+1,t,n))if(i){var y={row:t.row-2,col:t.col+1};(this._willBlockChecker(i,y)||this._willCaptureChecker(i,y))&&s.push(o({row:u.row-2,col:u.col+1}))}else s.push(o({row:u.row-2,col:u.col+1}))}if(u.row+2<8){if(u.col-1>=0&&this.canMoveHere(e,u.row+2,u.col-1,t,n))if(i){var y={row:t.row+2,col:t.col-1};(this._willBlockChecker(i,y)||this._willCaptureChecker(i,y))&&s.push(o({row:u.row+2,col:u.col-1}))}else s.push(o({row:u.row+2,col:u.col-1}));if(u.col+1<8&&this.canMoveHere(e,u.row+2,u.col+1,t,n))if(i){var y={row:t.row+2,col:t.col+1};if(this._willBlockChecker(i,y)||this._willCaptureChecker(i,y))console.log(this._willBlockChecker(i,y)),s.push(o({row:u.row+2,col:u.col+1}))}else s.push(o({row:u.row+2,col:u.col+1}))}if(u.col-2>=0){if(u.row-1>=0&&this.canMoveHere(e,u.row-1,u.col-2,t,n))if(i){var y={row:t.row-1,col:t.col-2};(this._willBlockChecker(i,y)||this._willCaptureChecker(i,y))&&s.push(o({row:u.row-1,col:u.col-2}))}else s.push(o({row:u.row-1,col:u.col-2}));if(u.row+1<8&&this.canMoveHere(e,u.row+1,u.col-2,t,n))if(i){var y={row:u.row+1,col:u.col-2};(this._willBlockChecker(i,y)||this._willCaptureChecker(i,y))&&s.push(o({row:u.row+1,col:u.col-2}))}else s.push(o({row:u.row+1,col:u.col-2}))}if(u.col+2<8){if(u.row-1>=0&&this.canMoveHere(e,u.row-1,u.col+2,t,n))if(i){var y={row:t.row-1,col:t.col+2};(this._willBlockChecker(i,y)||this._willCaptureChecker(i,y))&&s.push(o({row:u.row-1,col:u.col+2}))}else s.push(o({row:u.row-1,col:u.col+2}));if(u.row+1<8&&this.canMoveHere(e,u.row+1,u.col+2,t,n))if(i){var y={row:t.row-1,col:t.col+2};(this._willBlockChecker(i,y)||this._willCaptureChecker(i,y))&&s.push(o({row:u.row+1,col:u.col+2}))}else s.push(o({row:u.row+1,col:u.col+2}))}break;case"P":t.color=="W"?(t.col!=0&&t.row!=0&&(n&&this.isEnemyOwned(e,t.row-1,t.col-1,t)?i?i.from.row==t.row-1&&i.from.col==t.col-1&&s.push(o({row:t.row-1,col:t.col-1})):s.push(o({row:t.row-1,col:t.col-1})):n||s.push(o({row:t.row-1,col:t.col-1}))),t.col!=7&&t.row!=0&&(n&&this.isEnemyOwned(e,t.row-1,t.col+1,t)?i?i.from.row==t.row-1&&i.from.col==t.col+1&&s.push(o({row:t.row-1,col:t.col+1})):s.push(o({row:t.row-1,col:t.col+1})):n||s.push(o({row:t.row-1,col:t.col+1}))),t.row!=0&&!this.isOccupied(e,t.row-1,t.col)&&(i?this._willBlockChecker(i,{row:t.row-1,col:t.col})&&s.push(o({row:t.row-1,col:t.col})):n&&s.push(o({row:t.row-1,col:t.col})),t.row==6&&!this.isOccupied(e,t.row-2,t.col)&&(i?this._willBlockChecker(i,{row:t.row-2,col:t.col})&&s.push(o({row:t.row-2,col:t.col})):n&&s.push(o({row:t.row-2,col:t.col}))))):t.color=="B"&&(t.col!=0&&t.row!=7&&this.isEnemyOwned(e,t.row+1,t.col-1,t)&&(n&&this.isEnemyOwned(e,t.row+1,t.col-1,t)?i?i.from.row==t.row+1&&i.from.col==t.col-1&&s.push(o({row:t.row+1,col:t.col-1})):s.push(o({row:t.row+1,col:t.col-1})):n||s.push(o({row:t.row+1,col:t.col-1}))),t.col!=7&&t.row!=7&&(n&&this.isEnemyOwned(e,t.row+1,t.col+1,t)?i?i.from.row==t.row+1&&i.from.col==t.col+1&&s.push(o({row:t.row+1,col:t.col+1})):n&&s.push(o({row:t.row+1,col:t.col+1})):n||s.push(o({row:t.row+1,col:t.col+1}))),t.row!=7&&!this.isOccupied(e,t.row+1,t.col)&&(i?this._willBlockChecker(i,{row:t.row+1,col:t.col})&&s.push(o({row:t.row+1,col:t.col})):n&&s.push(o({row:t.row+1,col:t.col})),t.row==1&&!this.isOccupied(e,t.row+2,t.col)&&(i?this._willBlockChecker(i,{row:t.row+2,col:t.col})&&s.push(o({row:t.row+2,col:t.col})):n&&s.push(o({row:t.row+2,col:t.col})))))}return s}}})(typeof module=="undefined"?this.chessLogic={}:module);